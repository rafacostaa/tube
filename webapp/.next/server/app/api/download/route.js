"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/download/route";
exports.ids = ["app/api/download/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var C_Users_rafar_Documents_Workplace_tube_webapp_src_app_api_download_route_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./src/app/api/download/route.ts */ \"(rsc)/./src/app/api/download/route.ts\");\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/download/route\",\n        pathname: \"/api/download\",\n        filename: \"route\",\n        bundlePath: \"app/api/download/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\rafar\\\\Documents\\\\Workplace\\\\tube\\\\webapp\\\\src\\\\app\\\\api\\\\download\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_rafar_Documents_Workplace_tube_webapp_src_app_api_download_route_ts__WEBPACK_IMPORTED_MODULE_2__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/download/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZkb3dubG9hZCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZG93bmxvYWQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZkb3dubG9hZCUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNyYWZhciU1Q0RvY3VtZW50cyU1Q1dvcmtwbGFjZSU1Q3R1YmUlNUN3ZWJhcHAlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3JhZmFyJTVDRG9jdW1lbnRzJTVDV29ya3BsYWNlJTVDdHViZSU1Q3dlYmFwcCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDcUQ7QUFDcEg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDaUo7O0FBRWpKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veW91dHViZS1kb3dubG9hZGVyLXdlYmFwcC8/YTMwMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxyYWZhclxcXFxEb2N1bWVudHNcXFxcV29ya3BsYWNlXFxcXHR1YmVcXFxcd2ViYXBwXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGRvd25sb2FkXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kb3dubG9hZC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2Rvd25sb2FkXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9kb3dubG9hZC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXHJhZmFyXFxcXERvY3VtZW50c1xcXFxXb3JrcGxhY2VcXFxcdHViZVxcXFx3ZWJhcHBcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZG93bmxvYWRcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvZG93bmxvYWQvcm91dGVcIjtcbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/download/route.ts":
/*!***************************************!*\
  !*** ./src/app/api/download/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/downloadStore */ \"(rsc)/./src/lib/downloadStore.ts\");\n/* harmony import */ var _lib_utils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/utils */ \"(rsc)/./src/lib/utils.ts\");\n\n\n\n\n\nasync function POST(request) {\n    try {\n        const { url, type, quality } = await request.json();\n        console.log(\"DEBUG - Received parameters:\", {\n            url,\n            type,\n            quality\n        });\n        if (!url) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n                error: \"URL is required\"\n            }, {\n                status: 400\n            });\n        }\n        if (!type || ![\n            \"audio\",\n            \"video\"\n        ].includes(type)) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n                error: 'Type must be either \"audio\" or \"video\"'\n            }, {\n                status: 400\n            });\n        }\n        // Validate YouTube URL\n        const youtubeRegex = /^https?:\\/\\/(www\\.)?(youtube\\.com|youtu\\.be)\\/.+$/;\n        if (!youtubeRegex.test(url)) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n                error: \"Invalid YouTube URL\"\n            }, {\n                status: 400\n            });\n        }\n        // Generate unique download ID\n        const downloadId = (0,_lib_utils__WEBPACK_IMPORTED_MODULE_4__.generateId)();\n        // Store initial download state\n        _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, {\n            id: downloadId,\n            url,\n            type: type,\n            quality: quality || \"best\",\n            status: \"started\",\n            progress: 0,\n            filename: null,\n            title: null,\n            error: null,\n            createdAt: new Date().toISOString()\n        });\n        // Start the download in the background\n        setTimeout(()=>{\n            startDownload(downloadId, url, type, quality || \"best\").catch((error)=>{\n                console.error(`Background download error for ${downloadId}:`, error);\n                const failedData = _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.get(downloadId);\n                if (failedData) {\n                    failedData.status = \"failed\";\n                    failedData.error = error.message;\n                    _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, failedData);\n                }\n            });\n        }, 100);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n            downloadId,\n            status: \"started\",\n            message: \"Download initiated successfully\"\n        });\n    } catch (error) {\n        console.error(\"Download initiation error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_1__[\"default\"].json({\n            error: \"Failed to initiate download\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\nasync function startDownload(downloadId, url, type, quality) {\n    try {\n        console.log(`Starting download for ${downloadId}: ${url}`);\n        // Update status to downloading\n        const downloadData = _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.get(downloadId);\n        if (downloadData) {\n            downloadData.status = \"downloading\";\n            _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, downloadData);\n        }\n        // Get the path to dictionary.py in the parent directory\n        const dictionaryPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"..\", \"dictionary.py\");\n        // Build command arguments\n        const args = [\n            dictionaryPath,\n            url,\n            \"--download-type\",\n            type\n        ];\n        // Always pass quality parameter to avoid user input prompts\n        const qualityParam = quality || \"best\";\n        args.push(\"--quality\", qualityParam);\n        console.log(`DEBUG - Final args:`, args);\n        console.log(`DEBUG - Quality param: ${qualityParam}`);\n        console.log(`Spawning python with args:`, args);\n        console.log(`Working directory: ${path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"..\")}`);\n        // Use spawn for better Windows compatibility and real-time output\n        const pythonProcess = (0,child_process__WEBPACK_IMPORTED_MODULE_0__.spawn)(\"python\", args, {\n            cwd: path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"..\"),\n            stdio: [\n                \"ignore\",\n                \"pipe\",\n                \"pipe\"\n            ],\n            env: {\n                ...process.env,\n                PYTHONIOENCODING: \"utf-8\"\n            }\n        });\n        let outputBuffer = \"\";\n        pythonProcess.stdout.on(\"data\", (data)=>{\n            const output = data.toString();\n            outputBuffer += output;\n            console.log(`Python stdout [${downloadId}]: ${output.trim()}`);\n            // Try to extract progress information from output\n            const progressMatch = output.match(/(\\d+\\.?\\d*)%/);\n            if (progressMatch) {\n                const progress = parseFloat(progressMatch[1]);\n                const currentData = _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.get(downloadId);\n                if (currentData) {\n                    currentData.progress = Math.min(progress, 99);\n                    _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, currentData);\n                }\n            }\n        });\n        pythonProcess.stderr.on(\"data\", (data)=>{\n            const error = data.toString();\n            console.error(`Python stderr [${downloadId}]: ${error.trim()}`);\n            outputBuffer += error;\n        });\n        pythonProcess.on(\"close\", (code)=>{\n            console.log(`Python process closed with code: ${code} for ${downloadId}`);\n            const updatedData = _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.get(downloadId);\n            if (!updatedData) return;\n            if (code === 0) {\n                // Extract the title from output\n                const titleMatch = outputBuffer.match(/Title: (.+)/);\n                const videoTitle = titleMatch ? titleMatch[1].trim() : null;\n                // Success - parse filename from output\n                const audioMatch = outputBuffer.match(/\\[SUCCESS\\] Download completed! Audio converted to MP3: (.+\\.mp3)/);\n                const videoMatch = outputBuffer.match(/\\[SUCCESS\\] Download completed! Video saved to: (.+\\.mp4)/);\n                const audioOriginalMatch = outputBuffer.match(/\\[SUCCESS\\] Download completed! Audio already in MP3 format: (.+\\.mp3)/);\n                if (audioMatch || videoMatch || audioOriginalMatch) {\n                    const filenamePart = audioMatch?.[1] || videoMatch?.[1] || audioOriginalMatch?.[1];\n                    if (filenamePart) {\n                        // Use the original filename from the download\n                        const originalFilename = path__WEBPACK_IMPORTED_MODULE_2___default().basename(filenamePart);\n                        // If we have the video title, use it as a more descriptive filename\n                        // but keep the file extension from the actual downloaded file\n                        if (videoTitle) {\n                            const fileExtension = path__WEBPACK_IMPORTED_MODULE_2___default().extname(originalFilename);\n                            // Try to parse artist and song information from common formats\n                            let displayTitle = videoTitle;\n                            let parsedInfo = null;\n                            // Common YouTube music title patterns\n                            const patterns = [\n                                /^(.+?)\\s*-\\s*(.+)$/,\n                                /^(.+?)\\s*:\\s*(.+)$/,\n                                /^(.+?)\\s+by\\s+(.+)$/i,\n                                /^(.+?)\\s*\\|\\s*(.+)$/,\n                                /^(.+?)\\s*–\\s*(.+)$/\n                            ];\n                            for (const pattern of patterns){\n                                const match = videoTitle.match(pattern);\n                                if (match) {\n                                    const [, part1, part2] = match;\n                                    // For \"Song by Artist\" format, swap the parts\n                                    if (videoTitle.toLowerCase().includes(\" by \")) {\n                                        parsedInfo = {\n                                            artist: part2.trim(),\n                                            song: part1.trim()\n                                        };\n                                    } else {\n                                        parsedInfo = {\n                                            artist: part1.trim(),\n                                            song: part2.trim()\n                                        };\n                                    }\n                                    break;\n                                }\n                            }\n                            // If we successfully parsed artist and song, format nicely\n                            if (parsedInfo) {\n                                displayTitle = `${parsedInfo.artist} - ${parsedInfo.song}`;\n                            }\n                            // Clean the title for use as filename (remove invalid characters)\n                            const cleanTitle = displayTitle.replace(/[<>:\"/\\\\|?*]/g, \"\") // Remove invalid filename characters\n                            .replace(/\\s+/g, \" \") // Normalize whitespace\n                            .trim();\n                            updatedData.filename = `${cleanTitle}${fileExtension}`;\n                            updatedData.title = videoTitle; // Store original title\n                        } else {\n                            updatedData.filename = originalFilename;\n                        }\n                    }\n                }\n                updatedData.status = \"completed\";\n                updatedData.progress = 100;\n                console.log(`Download completed for ${downloadId}: ${updatedData.filename}`);\n            } else {\n                // Error\n                updatedData.status = \"failed\";\n                updatedData.error = outputBuffer || \"Download failed with unknown error\";\n                console.error(`Download failed for ${downloadId}:`, updatedData.error);\n            }\n            _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, updatedData);\n        });\n        pythonProcess.on(\"error\", (error)=>{\n            console.error(`Python process error for ${downloadId}:`, error.message);\n            const failedData = _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.get(downloadId);\n            if (failedData) {\n                failedData.status = \"failed\";\n                failedData.error = `Process error: ${error.message}`;\n                _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, failedData);\n            }\n        });\n    } catch (error) {\n        console.error(`Download error for ${downloadId}:`, error);\n        const failedData = _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.get(downloadId);\n        if (failedData) {\n            failedData.status = \"failed\";\n            failedData.error = error.message;\n            _lib_downloadStore__WEBPACK_IMPORTED_MODULE_3__.downloadStore.set(downloadId, failedData);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QzdCLDZEQUFhQSxDQUFDZ0IsR0FBRyxDQUFDRCxZQUFZWTtRQUNoQztJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95b3V0dWJlLWRvd25sb2FkZXItd2ViYXBwLy4vc3JjL2FwcC9hcGkvZG93bmxvYWQvcm91dGUudHM/YmMzNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzcGF3biB9IGZyb20gXCJjaGlsZF9wcm9jZXNzXCI7XHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcclxuaW1wb3J0IHsgZG93bmxvYWRTdG9yZSB9IGZyb20gXCIuLi8uLi8uLi9saWIvZG93bmxvYWRTdG9yZVwiO1xyXG5pbXBvcnQgeyBnZW5lcmF0ZUlkIH0gZnJvbSBcIi4uLy4uLy4uL2xpYi91dGlsc1wiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB1cmwsIHR5cGUsIHF1YWxpdHkgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiREVCVUcgLSBSZWNlaXZlZCBwYXJhbWV0ZXJzOlwiLCB7IHVybCwgdHlwZSwgcXVhbGl0eSB9KTtcclxuXHJcbiAgICBpZiAoIXVybCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJVUkwgaXMgcmVxdWlyZWRcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdHlwZSB8fCAhW1wiYXVkaW9cIiwgXCJ2aWRlb1wiXS5pbmNsdWRlcyh0eXBlKSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1R5cGUgbXVzdCBiZSBlaXRoZXIgXCJhdWRpb1wiIG9yIFwidmlkZW9cIicgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBZb3VUdWJlIFVSTFxyXG4gICAgY29uc3QgeW91dHViZVJlZ2V4ID0gL15odHRwcz86XFwvXFwvKHd3d1xcLik/KHlvdXR1YmVcXC5jb218eW91dHVcXC5iZSlcXC8uKyQvO1xyXG4gICAgaWYgKCF5b3V0dWJlUmVnZXgudGVzdCh1cmwpKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiBcIkludmFsaWQgWW91VHViZSBVUkxcIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBkb3dubG9hZCBJRFxyXG4gICAgY29uc3QgZG93bmxvYWRJZCA9IGdlbmVyYXRlSWQoKTtcclxuXHJcbiAgICAvLyBTdG9yZSBpbml0aWFsIGRvd25sb2FkIHN0YXRlXHJcbiAgICBkb3dubG9hZFN0b3JlLnNldChkb3dubG9hZElkLCB7XHJcbiAgICAgIGlkOiBkb3dubG9hZElkLFxyXG4gICAgICB1cmwsXHJcbiAgICAgIHR5cGU6IHR5cGUgYXMgXCJhdWRpb1wiIHwgXCJ2aWRlb1wiLFxyXG4gICAgICBxdWFsaXR5OiBxdWFsaXR5IHx8IFwiYmVzdFwiLFxyXG4gICAgICBzdGF0dXM6IFwic3RhcnRlZFwiLFxyXG4gICAgICBwcm9ncmVzczogMCxcclxuICAgICAgZmlsZW5hbWU6IG51bGwsXHJcbiAgICAgIHRpdGxlOiBudWxsLFxyXG4gICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBTdGFydCB0aGUgZG93bmxvYWQgaW4gdGhlIGJhY2tncm91bmRcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBzdGFydERvd25sb2FkKGRvd25sb2FkSWQsIHVybCwgdHlwZSwgcXVhbGl0eSB8fCBcImJlc3RcIikuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgQmFja2dyb3VuZCBkb3dubG9hZCBlcnJvciBmb3IgJHtkb3dubG9hZElkfTpgLCBlcnJvcik7XHJcbiAgICAgICAgY29uc3QgZmFpbGVkRGF0YSA9IGRvd25sb2FkU3RvcmUuZ2V0KGRvd25sb2FkSWQpO1xyXG4gICAgICAgIGlmIChmYWlsZWREYXRhKSB7XHJcbiAgICAgICAgICBmYWlsZWREYXRhLnN0YXR1cyA9IFwiZmFpbGVkXCI7XHJcbiAgICAgICAgICBmYWlsZWREYXRhLmVycm9yID0gZXJyb3IubWVzc2FnZTtcclxuICAgICAgICAgIGRvd25sb2FkU3RvcmUuc2V0KGRvd25sb2FkSWQsIGZhaWxlZERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9LCAxMDApO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIGRvd25sb2FkSWQsXHJcbiAgICAgIHN0YXR1czogXCJzdGFydGVkXCIsXHJcbiAgICAgIG1lc3NhZ2U6IFwiRG93bmxvYWQgaW5pdGlhdGVkIHN1Y2Nlc3NmdWxseVwiLFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkRvd25sb2FkIGluaXRpYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAge1xyXG4gICAgICAgIGVycm9yOiBcIkZhaWxlZCB0byBpbml0aWF0ZSBkb3dubG9hZFwiLFxyXG4gICAgICAgIGRldGFpbHM6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0RG93bmxvYWQoXHJcbiAgZG93bmxvYWRJZDogc3RyaW5nLFxyXG4gIHVybDogc3RyaW5nLFxyXG4gIHR5cGU6IHN0cmluZyxcclxuICBxdWFsaXR5OiBzdHJpbmdcclxuKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKGBTdGFydGluZyBkb3dubG9hZCBmb3IgJHtkb3dubG9hZElkfTogJHt1cmx9YCk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHN0YXR1cyB0byBkb3dubG9hZGluZ1xyXG4gICAgY29uc3QgZG93bmxvYWREYXRhID0gZG93bmxvYWRTdG9yZS5nZXQoZG93bmxvYWRJZCk7XHJcbiAgICBpZiAoZG93bmxvYWREYXRhKSB7XHJcbiAgICAgIGRvd25sb2FkRGF0YS5zdGF0dXMgPSBcImRvd25sb2FkaW5nXCI7XHJcbiAgICAgIGRvd25sb2FkU3RvcmUuc2V0KGRvd25sb2FkSWQsIGRvd25sb2FkRGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHRoZSBwYXRoIHRvIGRpY3Rpb25hcnkucHkgaW4gdGhlIHBhcmVudCBkaXJlY3RvcnlcclxuICAgIGNvbnN0IGRpY3Rpb25hcnlQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwiLi5cIiwgXCJkaWN0aW9uYXJ5LnB5XCIpO1xyXG5cclxuICAgIC8vIEJ1aWxkIGNvbW1hbmQgYXJndW1lbnRzXHJcbiAgICBjb25zdCBhcmdzID0gW2RpY3Rpb25hcnlQYXRoLCB1cmwsIFwiLS1kb3dubG9hZC10eXBlXCIsIHR5cGVdO1xyXG5cclxuICAgIC8vIEFsd2F5cyBwYXNzIHF1YWxpdHkgcGFyYW1ldGVyIHRvIGF2b2lkIHVzZXIgaW5wdXQgcHJvbXB0c1xyXG4gICAgY29uc3QgcXVhbGl0eVBhcmFtID0gcXVhbGl0eSB8fCBcImJlc3RcIjtcclxuICAgIGFyZ3MucHVzaChcIi0tcXVhbGl0eVwiLCBxdWFsaXR5UGFyYW0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGBERUJVRyAtIEZpbmFsIGFyZ3M6YCwgYXJncyk7XHJcbiAgICBjb25zb2xlLmxvZyhgREVCVUcgLSBRdWFsaXR5IHBhcmFtOiAke3F1YWxpdHlQYXJhbX1gKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgU3Bhd25pbmcgcHl0aG9uIHdpdGggYXJnczpgLCBhcmdzKTtcclxuICAgIGNvbnNvbGUubG9nKGBXb3JraW5nIGRpcmVjdG9yeTogJHtwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgXCIuLlwiKX1gKTtcclxuXHJcbiAgICAvLyBVc2Ugc3Bhd24gZm9yIGJldHRlciBXaW5kb3dzIGNvbXBhdGliaWxpdHkgYW5kIHJlYWwtdGltZSBvdXRwdXRcclxuICAgIGNvbnN0IHB5dGhvblByb2Nlc3MgPSBzcGF3bihcInB5dGhvblwiLCBhcmdzLCB7XHJcbiAgICAgIGN3ZDogcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIFwiLi5cIiksXHJcbiAgICAgIHN0ZGlvOiBbXCJpZ25vcmVcIiwgXCJwaXBlXCIsIFwicGlwZVwiXSxcclxuICAgICAgZW52OiB7IC4uLnByb2Nlc3MuZW52LCBQWVRIT05JT0VOQ09ESU5HOiBcInV0Zi04XCIgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIGxldCBvdXRwdXRCdWZmZXIgPSBcIlwiO1xyXG5cclxuICAgIHB5dGhvblByb2Nlc3Muc3Rkb3V0Lm9uKFwiZGF0YVwiLCAoZGF0YTogQnVmZmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dCA9IGRhdGEudG9TdHJpbmcoKTtcclxuICAgICAgb3V0cHV0QnVmZmVyICs9IG91dHB1dDtcclxuICAgICAgY29uc29sZS5sb2coYFB5dGhvbiBzdGRvdXQgWyR7ZG93bmxvYWRJZH1dOiAke291dHB1dC50cmltKCl9YCk7XHJcblxyXG4gICAgICAvLyBUcnkgdG8gZXh0cmFjdCBwcm9ncmVzcyBpbmZvcm1hdGlvbiBmcm9tIG91dHB1dFxyXG4gICAgICBjb25zdCBwcm9ncmVzc01hdGNoID0gb3V0cHV0Lm1hdGNoKC8oXFxkK1xcLj9cXGQqKSUvKTtcclxuICAgICAgaWYgKHByb2dyZXNzTWF0Y2gpIHtcclxuICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHBhcnNlRmxvYXQocHJvZ3Jlc3NNYXRjaFsxXSk7XHJcbiAgICAgICAgY29uc3QgY3VycmVudERhdGEgPSBkb3dubG9hZFN0b3JlLmdldChkb3dubG9hZElkKTtcclxuICAgICAgICBpZiAoY3VycmVudERhdGEpIHtcclxuICAgICAgICAgIGN1cnJlbnREYXRhLnByb2dyZXNzID0gTWF0aC5taW4ocHJvZ3Jlc3MsIDk5KTtcclxuICAgICAgICAgIGRvd25sb2FkU3RvcmUuc2V0KGRvd25sb2FkSWQsIGN1cnJlbnREYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHB5dGhvblByb2Nlc3Muc3RkZXJyLm9uKFwiZGF0YVwiLCAoZGF0YTogQnVmZmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gZGF0YS50b1N0cmluZygpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBQeXRob24gc3RkZXJyIFske2Rvd25sb2FkSWR9XTogJHtlcnJvci50cmltKCl9YCk7XHJcbiAgICAgIG91dHB1dEJ1ZmZlciArPSBlcnJvcjtcclxuICAgIH0pO1xyXG5cclxuICAgIHB5dGhvblByb2Nlc3Mub24oXCJjbG9zZVwiLCAoY29kZTogbnVtYmVyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBQeXRob24gcHJvY2VzcyBjbG9zZWQgd2l0aCBjb2RlOiAke2NvZGV9IGZvciAke2Rvd25sb2FkSWR9YCk7XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVkRGF0YSA9IGRvd25sb2FkU3RvcmUuZ2V0KGRvd25sb2FkSWQpO1xyXG4gICAgICBpZiAoIXVwZGF0ZWREYXRhKSByZXR1cm47XHJcblxyXG4gICAgICBpZiAoY29kZSA9PT0gMCkge1xyXG4gICAgICAgIC8vIEV4dHJhY3QgdGhlIHRpdGxlIGZyb20gb3V0cHV0XHJcbiAgICAgICAgY29uc3QgdGl0bGVNYXRjaCA9IG91dHB1dEJ1ZmZlci5tYXRjaCgvVGl0bGU6ICguKykvKTtcclxuICAgICAgICBjb25zdCB2aWRlb1RpdGxlID0gdGl0bGVNYXRjaCA/IHRpdGxlTWF0Y2hbMV0udHJpbSgpIDogbnVsbDtcclxuXHJcbiAgICAgICAgLy8gU3VjY2VzcyAtIHBhcnNlIGZpbGVuYW1lIGZyb20gb3V0cHV0XHJcbiAgICAgICAgY29uc3QgYXVkaW9NYXRjaCA9IG91dHB1dEJ1ZmZlci5tYXRjaChcclxuICAgICAgICAgIC9cXFtTVUNDRVNTXFxdIERvd25sb2FkIGNvbXBsZXRlZCEgQXVkaW8gY29udmVydGVkIHRvIE1QMzogKC4rXFwubXAzKS9cclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnN0IHZpZGVvTWF0Y2ggPSBvdXRwdXRCdWZmZXIubWF0Y2goXHJcbiAgICAgICAgICAvXFxbU1VDQ0VTU1xcXSBEb3dubG9hZCBjb21wbGV0ZWQhIFZpZGVvIHNhdmVkIHRvOiAoLitcXC5tcDQpL1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgY29uc3QgYXVkaW9PcmlnaW5hbE1hdGNoID0gb3V0cHV0QnVmZmVyLm1hdGNoKFxyXG4gICAgICAgICAgL1xcW1NVQ0NFU1NcXF0gRG93bmxvYWQgY29tcGxldGVkISBBdWRpbyBhbHJlYWR5IGluIE1QMyBmb3JtYXQ6ICguK1xcLm1wMykvXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgaWYgKGF1ZGlvTWF0Y2ggfHwgdmlkZW9NYXRjaCB8fCBhdWRpb09yaWdpbmFsTWF0Y2gpIHtcclxuICAgICAgICAgIGNvbnN0IGZpbGVuYW1lUGFydCA9XHJcbiAgICAgICAgICAgIGF1ZGlvTWF0Y2g/LlsxXSB8fCB2aWRlb01hdGNoPy5bMV0gfHwgYXVkaW9PcmlnaW5hbE1hdGNoPy5bMV07XHJcblxyXG4gICAgICAgICAgaWYgKGZpbGVuYW1lUGFydCkge1xyXG4gICAgICAgICAgICAvLyBVc2UgdGhlIG9yaWdpbmFsIGZpbGVuYW1lIGZyb20gdGhlIGRvd25sb2FkXHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRmlsZW5hbWUgPSBwYXRoLmJhc2VuYW1lKGZpbGVuYW1lUGFydCk7XHJcblxyXG4gICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIHRoZSB2aWRlbyB0aXRsZSwgdXNlIGl0IGFzIGEgbW9yZSBkZXNjcmlwdGl2ZSBmaWxlbmFtZVxyXG4gICAgICAgICAgICAvLyBidXQga2VlcCB0aGUgZmlsZSBleHRlbnNpb24gZnJvbSB0aGUgYWN0dWFsIGRvd25sb2FkZWQgZmlsZVxyXG4gICAgICAgICAgICBpZiAodmlkZW9UaXRsZSkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSBwYXRoLmV4dG5hbWUob3JpZ2luYWxGaWxlbmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgIC8vIFRyeSB0byBwYXJzZSBhcnRpc3QgYW5kIHNvbmcgaW5mb3JtYXRpb24gZnJvbSBjb21tb24gZm9ybWF0c1xyXG4gICAgICAgICAgICAgIGxldCBkaXNwbGF5VGl0bGUgPSB2aWRlb1RpdGxlO1xyXG4gICAgICAgICAgICAgIGxldCBwYXJzZWRJbmZvID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgLy8gQ29tbW9uIFlvdVR1YmUgbXVzaWMgdGl0bGUgcGF0dGVybnNcclxuICAgICAgICAgICAgICBjb25zdCBwYXR0ZXJucyA9IFtcclxuICAgICAgICAgICAgICAgIC9eKC4rPylcXHMqLVxccyooLispJC8sIC8vIFwiQXJ0aXN0IC0gU29uZ1wiXHJcbiAgICAgICAgICAgICAgICAvXiguKz8pXFxzKjpcXHMqKC4rKSQvLCAvLyBcIkFydGlzdDogU29uZ1wiXHJcbiAgICAgICAgICAgICAgICAvXiguKz8pXFxzK2J5XFxzKyguKykkL2ksIC8vIFwiU29uZyBieSBBcnRpc3RcIlxyXG4gICAgICAgICAgICAgICAgL14oLis/KVxccypcXHxcXHMqKC4rKSQvLCAvLyBcIkFydGlzdCB8IFNvbmdcIlxyXG4gICAgICAgICAgICAgICAgL14oLis/KVxccyrigJNcXHMqKC4rKSQvLCAvLyBcIkFydGlzdCDigJMgU29uZ1wiIChlbSBkYXNoKVxyXG4gICAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBwYXR0ZXJucykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSB2aWRlb1RpdGxlLm1hdGNoKHBhdHRlcm4pO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IFssIHBhcnQxLCBwYXJ0Ml0gPSBtYXRjaDtcclxuICAgICAgICAgICAgICAgICAgLy8gRm9yIFwiU29uZyBieSBBcnRpc3RcIiBmb3JtYXQsIHN3YXAgdGhlIHBhcnRzXHJcbiAgICAgICAgICAgICAgICAgIGlmICh2aWRlb1RpdGxlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCIgYnkgXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VkSW5mbyA9IHsgYXJ0aXN0OiBwYXJ0Mi50cmltKCksIHNvbmc6IHBhcnQxLnRyaW0oKSB9O1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZEluZm8gPSB7IGFydGlzdDogcGFydDEudHJpbSgpLCBzb25nOiBwYXJ0Mi50cmltKCkgfTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIC8vIElmIHdlIHN1Y2Nlc3NmdWxseSBwYXJzZWQgYXJ0aXN0IGFuZCBzb25nLCBmb3JtYXQgbmljZWx5XHJcbiAgICAgICAgICAgICAgaWYgKHBhcnNlZEluZm8pIHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlUaXRsZSA9IGAke3BhcnNlZEluZm8uYXJ0aXN0fSAtICR7cGFyc2VkSW5mby5zb25nfWA7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAvLyBDbGVhbiB0aGUgdGl0bGUgZm9yIHVzZSBhcyBmaWxlbmFtZSAocmVtb3ZlIGludmFsaWQgY2hhcmFjdGVycylcclxuICAgICAgICAgICAgICBjb25zdCBjbGVhblRpdGxlID0gZGlzcGxheVRpdGxlXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvWzw+OlwiL1xcXFx8PypdL2csIFwiXCIpIC8vIFJlbW92ZSBpbnZhbGlkIGZpbGVuYW1lIGNoYXJhY3RlcnNcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKSAvLyBOb3JtYWxpemUgd2hpdGVzcGFjZVxyXG4gICAgICAgICAgICAgICAgLnRyaW0oKTtcclxuXHJcbiAgICAgICAgICAgICAgdXBkYXRlZERhdGEuZmlsZW5hbWUgPSBgJHtjbGVhblRpdGxlfSR7ZmlsZUV4dGVuc2lvbn1gO1xyXG4gICAgICAgICAgICAgIHVwZGF0ZWREYXRhLnRpdGxlID0gdmlkZW9UaXRsZTsgLy8gU3RvcmUgb3JpZ2luYWwgdGl0bGVcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICB1cGRhdGVkRGF0YS5maWxlbmFtZSA9IG9yaWdpbmFsRmlsZW5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHVwZGF0ZWREYXRhLnN0YXR1cyA9IFwiY29tcGxldGVkXCI7XHJcbiAgICAgICAgdXBkYXRlZERhdGEucHJvZ3Jlc3MgPSAxMDA7XHJcbiAgICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgICBgRG93bmxvYWQgY29tcGxldGVkIGZvciAke2Rvd25sb2FkSWR9OiAke3VwZGF0ZWREYXRhLmZpbGVuYW1lfWBcclxuICAgICAgICApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEVycm9yXHJcbiAgICAgICAgdXBkYXRlZERhdGEuc3RhdHVzID0gXCJmYWlsZWRcIjtcclxuICAgICAgICB1cGRhdGVkRGF0YS5lcnJvciA9XHJcbiAgICAgICAgICBvdXRwdXRCdWZmZXIgfHwgXCJEb3dubG9hZCBmYWlsZWQgd2l0aCB1bmtub3duIGVycm9yXCI7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgRG93bmxvYWQgZmFpbGVkIGZvciAke2Rvd25sb2FkSWR9OmAsIHVwZGF0ZWREYXRhLmVycm9yKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZG93bmxvYWRTdG9yZS5zZXQoZG93bmxvYWRJZCwgdXBkYXRlZERhdGEpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcHl0aG9uUHJvY2Vzcy5vbihcImVycm9yXCIsIChlcnJvcjogRXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihgUHl0aG9uIHByb2Nlc3MgZXJyb3IgZm9yICR7ZG93bmxvYWRJZH06YCwgZXJyb3IubWVzc2FnZSk7XHJcblxyXG4gICAgICBjb25zdCBmYWlsZWREYXRhID0gZG93bmxvYWRTdG9yZS5nZXQoZG93bmxvYWRJZCk7XHJcbiAgICAgIGlmIChmYWlsZWREYXRhKSB7XHJcbiAgICAgICAgZmFpbGVkRGF0YS5zdGF0dXMgPSBcImZhaWxlZFwiO1xyXG4gICAgICAgIGZhaWxlZERhdGEuZXJyb3IgPSBgUHJvY2VzcyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWA7XHJcbiAgICAgICAgZG93bmxvYWRTdG9yZS5zZXQoZG93bmxvYWRJZCwgZmFpbGVkRGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoYERvd25sb2FkIGVycm9yIGZvciAke2Rvd25sb2FkSWR9OmAsIGVycm9yKTtcclxuICAgIGNvbnN0IGZhaWxlZERhdGEgPSBkb3dubG9hZFN0b3JlLmdldChkb3dubG9hZElkKTtcclxuICAgIGlmIChmYWlsZWREYXRhKSB7XHJcbiAgICAgIGZhaWxlZERhdGEuc3RhdHVzID0gXCJmYWlsZWRcIjtcclxuICAgICAgZmFpbGVkRGF0YS5lcnJvciA9IGVycm9yLm1lc3NhZ2U7XHJcbiAgICAgIGRvd25sb2FkU3RvcmUuc2V0KGRvd25sb2FkSWQsIGZhaWxlZERhdGEpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsic3Bhd24iLCJOZXh0UmVzcG9uc2UiLCJwYXRoIiwiZG93bmxvYWRTdG9yZSIsImdlbmVyYXRlSWQiLCJQT1NUIiwicmVxdWVzdCIsInVybCIsInR5cGUiLCJxdWFsaXR5IiwianNvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsInN0YXR1cyIsImluY2x1ZGVzIiwieW91dHViZVJlZ2V4IiwidGVzdCIsImRvd25sb2FkSWQiLCJzZXQiLCJpZCIsInByb2dyZXNzIiwiZmlsZW5hbWUiLCJ0aXRsZSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInNldFRpbWVvdXQiLCJzdGFydERvd25sb2FkIiwiY2F0Y2giLCJmYWlsZWREYXRhIiwiZ2V0IiwibWVzc2FnZSIsImRldGFpbHMiLCJkb3dubG9hZERhdGEiLCJkaWN0aW9uYXJ5UGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiYXJncyIsInF1YWxpdHlQYXJhbSIsInB1c2giLCJweXRob25Qcm9jZXNzIiwic3RkaW8iLCJlbnYiLCJQWVRIT05JT0VOQ09ESU5HIiwib3V0cHV0QnVmZmVyIiwic3Rkb3V0Iiwib24iLCJkYXRhIiwib3V0cHV0IiwidG9TdHJpbmciLCJ0cmltIiwicHJvZ3Jlc3NNYXRjaCIsIm1hdGNoIiwicGFyc2VGbG9hdCIsImN1cnJlbnREYXRhIiwiTWF0aCIsIm1pbiIsInN0ZGVyciIsImNvZGUiLCJ1cGRhdGVkRGF0YSIsInRpdGxlTWF0Y2giLCJ2aWRlb1RpdGxlIiwiYXVkaW9NYXRjaCIsInZpZGVvTWF0Y2giLCJhdWRpb09yaWdpbmFsTWF0Y2giLCJmaWxlbmFtZVBhcnQiLCJvcmlnaW5hbEZpbGVuYW1lIiwiYmFzZW5hbWUiLCJmaWxlRXh0ZW5zaW9uIiwiZXh0bmFtZSIsImRpc3BsYXlUaXRsZSIsInBhcnNlZEluZm8iLCJwYXR0ZXJucyIsInBhdHRlcm4iLCJwYXJ0MSIsInBhcnQyIiwidG9Mb3dlckNhc2UiLCJhcnRpc3QiLCJzb25nIiwiY2xlYW5UaXRsZSIsInJlcGxhY2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/download/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/downloadStore.ts":
/*!**********************************!*\
  !*** ./src/lib/downloadStore.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   downloadStore: () => (/* binding */ downloadStore)\n/* harmony export */ });\n// Shared in-memory store for download progress\n// In production, this should be replaced with Redis or a database\nclass DownloadStore {\n    set(id, data) {\n        this.store.set(id, data);\n    }\n    get(id) {\n        return this.store.get(id);\n    }\n    delete(id) {\n        return this.store.delete(id);\n    }\n    // Clean up old downloads (older than 1 hour)\n    cleanup() {\n        const oneHourAgo = Date.now() - 60 * 60 * 1000;\n        const entries = Array.from(this.store.entries());\n        for (const [id, data] of entries){\n            const createdAt = new Date(data.createdAt).getTime();\n            if (createdAt < oneHourAgo) {\n                this.store.delete(id);\n            }\n        }\n    }\n    constructor(){\n        this.store = new Map();\n    }\n}\n// Export singleton instance\nconst downloadStore = new DownloadStore(); // Clean up old downloads periodically (called manually instead of setInterval to avoid hanging)\n // setInterval(() => {\n //   downloadStore.cleanup();\n // }, 10 * 60 * 1000);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2Rvd25sb2FkU3RvcmUudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLCtDQUErQztBQUMvQyxrRUFBa0U7QUFlbEUsTUFBTUE7SUFHSkMsSUFBSUMsRUFBVSxFQUFFQyxJQUFrQixFQUFRO1FBQ3hDLElBQUksQ0FBQ0MsS0FBSyxDQUFDSCxHQUFHLENBQUNDLElBQUlDO0lBQ3JCO0lBRUFFLElBQUlILEVBQVUsRUFBNEI7UUFDeEMsT0FBTyxJQUFJLENBQUNFLEtBQUssQ0FBQ0MsR0FBRyxDQUFDSDtJQUN4QjtJQUVBSSxPQUFPSixFQUFVLEVBQVc7UUFDMUIsT0FBTyxJQUFJLENBQUNFLEtBQUssQ0FBQ0UsTUFBTSxDQUFDSjtJQUMzQjtJQUVBLDZDQUE2QztJQUM3Q0ssVUFBZ0I7UUFDZCxNQUFNQyxhQUFhQyxLQUFLQyxHQUFHLEtBQUssS0FBSyxLQUFLO1FBQzFDLE1BQU1DLFVBQVVDLE1BQU1DLElBQUksQ0FBQyxJQUFJLENBQUNULEtBQUssQ0FBQ08sT0FBTztRQUM3QyxLQUFLLE1BQU0sQ0FBQ1QsSUFBSUMsS0FBSyxJQUFJUSxRQUFTO1lBQ2hDLE1BQU1HLFlBQVksSUFBSUwsS0FBS04sS0FBS1csU0FBUyxFQUFFQyxPQUFPO1lBQ2xELElBQUlELFlBQVlOLFlBQVk7Z0JBQzFCLElBQUksQ0FBQ0osS0FBSyxDQUFDRSxNQUFNLENBQUNKO1lBQ3BCO1FBQ0Y7SUFDRjs7YUF4QlFFLFFBQVEsSUFBSVk7O0FBeUJ0QjtBQUVBLDRCQUE0QjtBQUNyQixNQUFNQyxnQkFBZ0IsSUFBSWpCLGdCQUFnQixDQUVqRCxnR0FBZ0c7Q0FDaEcsc0JBQXNCO0NBQ3RCLDZCQUE2QjtDQUM3QixzQkFBc0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95b3V0dWJlLWRvd25sb2FkZXItd2ViYXBwLy4vc3JjL2xpYi9kb3dubG9hZFN0b3JlLnRzPzBjOTciXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2hhcmVkIGluLW1lbW9yeSBzdG9yZSBmb3IgZG93bmxvYWQgcHJvZ3Jlc3NcclxuLy8gSW4gcHJvZHVjdGlvbiwgdGhpcyBzaG91bGQgYmUgcmVwbGFjZWQgd2l0aCBSZWRpcyBvciBhIGRhdGFiYXNlXHJcblxyXG5pbnRlcmZhY2UgRG93bmxvYWREYXRhIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHVybDogc3RyaW5nO1xyXG4gIHR5cGU6IFwiYXVkaW9cIiB8IFwidmlkZW9cIjtcclxuICBxdWFsaXR5OiBzdHJpbmc7XHJcbiAgc3RhdHVzOiBcInN0YXJ0ZWRcIiB8IFwiZG93bmxvYWRpbmdcIiB8IFwiY29tcGxldGVkXCIgfCBcImZhaWxlZFwiO1xyXG4gIHByb2dyZXNzOiBudW1iZXI7XHJcbiAgZmlsZW5hbWU6IHN0cmluZyB8IG51bGw7XHJcbiAgdGl0bGU6IHN0cmluZyB8IG51bGw7XHJcbiAgZXJyb3I6IHN0cmluZyB8IG51bGw7XHJcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XHJcbn1cclxuXHJcbmNsYXNzIERvd25sb2FkU3RvcmUge1xyXG4gIHByaXZhdGUgc3RvcmUgPSBuZXcgTWFwPHN0cmluZywgRG93bmxvYWREYXRhPigpO1xyXG5cclxuICBzZXQoaWQ6IHN0cmluZywgZGF0YTogRG93bmxvYWREYXRhKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0b3JlLnNldChpZCwgZGF0YSk7XHJcbiAgfVxyXG5cclxuICBnZXQoaWQ6IHN0cmluZyk6IERvd25sb2FkRGF0YSB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5nZXQoaWQpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKGlkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnN0b3JlLmRlbGV0ZShpZCk7XHJcbiAgfVxyXG5cclxuICAvLyBDbGVhbiB1cCBvbGQgZG93bmxvYWRzIChvbGRlciB0aGFuIDEgaG91cilcclxuICBjbGVhbnVwKCk6IHZvaWQge1xyXG4gICAgY29uc3Qgb25lSG91ckFnbyA9IERhdGUubm93KCkgLSA2MCAqIDYwICogMTAwMDtcclxuICAgIGNvbnN0IGVudHJpZXMgPSBBcnJheS5mcm9tKHRoaXMuc3RvcmUuZW50cmllcygpKTtcclxuICAgIGZvciAoY29uc3QgW2lkLCBkYXRhXSBvZiBlbnRyaWVzKSB7XHJcbiAgICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKGRhdGEuY3JlYXRlZEF0KS5nZXRUaW1lKCk7XHJcbiAgICAgIGlmIChjcmVhdGVkQXQgPCBvbmVIb3VyQWdvKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yZS5kZWxldGUoaWQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXHJcbmV4cG9ydCBjb25zdCBkb3dubG9hZFN0b3JlID0gbmV3IERvd25sb2FkU3RvcmUoKTtcclxuXHJcbi8vIENsZWFuIHVwIG9sZCBkb3dubG9hZHMgcGVyaW9kaWNhbGx5IChjYWxsZWQgbWFudWFsbHkgaW5zdGVhZCBvZiBzZXRJbnRlcnZhbCB0byBhdm9pZCBoYW5naW5nKVxyXG4vLyBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbi8vICAgZG93bmxvYWRTdG9yZS5jbGVhbnVwKCk7XHJcbi8vIH0sIDEwICogNjAgKiAxMDAwKTtcclxuIl0sIm5hbWVzIjpbIkRvd25sb2FkU3RvcmUiLCJzZXQiLCJpZCIsImRhdGEiLCJzdG9yZSIsImdldCIsImRlbGV0ZSIsImNsZWFudXAiLCJvbmVIb3VyQWdvIiwiRGF0ZSIsIm5vdyIsImVudHJpZXMiLCJBcnJheSIsImZyb20iLCJjcmVhdGVkQXQiLCJnZXRUaW1lIiwiTWFwIiwiZG93bmxvYWRTdG9yZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/downloadStore.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/utils.ts":
/*!**************************!*\
  !*** ./src/lib/utils.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateId: () => (/* binding */ generateId)\n/* harmony export */ });\n// Simple UUID v4 generator\nfunction generateId() {\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n        const r = Math.random() * 16 | 0;\n        const v = c === \"x\" ? r : r & 0x3 | 0x8;\n        return v.toString(16);\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3V0aWxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSwyQkFBMkI7QUFDcEIsU0FBU0E7SUFDZCxPQUFPLHVDQUF1Q0MsT0FBTyxDQUFDLFNBQVMsU0FBVUMsQ0FBQztRQUN4RSxNQUFNQyxJQUFJLEtBQU1FLE1BQU0sS0FBSyxLQUFNO1FBQ2pDLE1BQU1DLElBQUlKLE1BQU0sTUFBTUMsSUFBSSxJQUFLLE1BQU87UUFDdEMsT0FBT0csRUFBRUMsUUFBUSxDQUFDO0lBQ3BCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95b3V0dWJlLWRvd25sb2FkZXItd2ViYXBwLy4vc3JjL2xpYi91dGlscy50cz83YzFjIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNpbXBsZSBVVUlEIHY0IGdlbmVyYXRvclxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVJZCgpOiBzdHJpbmcge1xyXG4gIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHtcclxuICAgIGNvbnN0IHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDA7XHJcbiAgICBjb25zdCB2ID0gYyA9PT0gXCJ4XCIgPyByIDogKHIgJiAweDMpIHwgMHg4O1xyXG4gICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJnZW5lcmF0ZUlkIiwicmVwbGFjZSIsImMiLCJyIiwiTWF0aCIsInJhbmRvbSIsInYiLCJ0b1N0cmluZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/utils.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Crafar%5CDocuments%5CWorkplace%5Ctube%5Cwebapp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();